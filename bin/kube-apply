
if [ -z "$YAML_PATH" ] && [ -z "$YAML_CONTENT" ]
then
	echo "Path or content must be specified!"
	exit 1
fi

if [ -n "$YAML_CONTENT" ]
then
YAML_PATH="./.cicd_apply.yaml"
cat <<EOF> $YAML_PATH
$YAML_CONTENT
EOF
fi

if [ ! -f "$YAML_PATH" ]
then
	echo "File \"$YAML_PATH\" not found! "
	exit 1
fi

if [ -z "$CICD_REGISTRY" ]
then
	CICD_REGISTRY=$CICD_LOCAL_REGISTRY
fi

if [ -n "$CICD_IMAGE_REPO" ]
then
	CICD_IMAGE="$CICD_REGISTRY/$CICD_IMAGE_REPO"
fi

echo "perform env var substitution"
cat "$YAML_PATH" | envsubst | kubectl apply -f -
